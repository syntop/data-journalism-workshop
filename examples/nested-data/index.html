<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Nested Data</title>
        <style>
            .foo rect {
                fill: #ccc;
            }

            .foo circle {
                fill: #666;
            }
        </style>
    </head>
    <body>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script>
            var width = window.innerWidth,
                height = window.innerHeight,
                barWidth = 100,
                gap = 10;

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            var data = [
                {
                    "foo": 12,
                    "bar": [1,2,4,8,16]
                },
                {
                    "foo": 17,
                    "bar": [1,2,3,5,8,13,21]
                },
                {
                    "foo": 8,
                    "bar": [0, 8, 15]
                }
            ];

            svg.selectAll('.foo')
                .data(data)
                .enter()
                .append('g')
                .attr('class', 'foo')
                .append('rect')
                .attr('x', function(d, i) {
                    return i * (barWidth + gap);
                })
                .attr('y', 0)
                .attr('width', barWidth)
                .attr('height', function(d) {
                    return d.foo * 20;
                })

            svg.selectAll('.foo')
                .each(function(d, i) {
                    var g = this;
                    d.bar.forEach(function(value, j) {
                        d3.select(g)
                            .append('circle')
                            .attr('cx', i * (barWidth + gap) + barWidth/2)
                            .attr('cy', function(d) {
                                return 50*j
                            })
                            .attr('r', value)
                    })
                })

            d3.select(self.frameElement).style("height", height + "px");
        </script>
    </body>
</html>
